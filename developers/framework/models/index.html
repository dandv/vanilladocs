<!DOCTYPE html><html lang=en><head><meta charset=utf-8><title>Models and Forms &middot; Vanilla Documentation</title><meta name=description content=""><meta name=keywords content=""><meta name=viewport content="width=device-width"><link rel=stylesheet href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro:400,600"><link rel=stylesheet href=/assets/c8a72ac1.main.css><body><!--[if lt IE 9]>
      <p class="alert alert-warning text-center outdated-browser">You are using an <strong>outdated</strong> browser. Please <a class="alert-link" href="http://outdatedbrowser.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]--><div id=top></div><nav class="navbar navbar-default navbar-static-top" role=navigation><div class=container><!-- Brand and toggle get grouped for better mobile display --><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href="/"><img class=logo src=/assets/img/9bdefa97.logo.svg alt="Vanilla Forums" width=102 height=41> Docs</a></div><!-- Collect the nav links, forms, and other content for toggling --><div class="collapse navbar-collapse"><div class="navbar-form navbar-left"><div class="dropdown js-search" role=search><div class=form-group><input class="form-control js-search-input" id=docs-search title="Search the documentation" placeholder=Search></div><ul class="dropdown-menu dropdown-search-results js-search-results"><li><a><span class=title></span> <span class=categories></span></a></li></ul></div></div><ul class="nav navbar-nav navbar-right"><li><a href=http://vanillaforums.com>Cloud Hosted Community</a></li><li><a href=http://vanillaforums.org>Open Source Community</a></li></ul></div></div></nav><header class="jumbotron masthead" role=banner><div class=container><h1>Models and Forms</h1></div></header><div class=container><ol class=breadcrumb><li itemscope itemtype=http://data-vocabulary.org/Breadcrumb><a href="/" itemprop=url><span itemprop=title>Home</span></a></li><li itemscope itemtype=http://data-vocabulary.org/Breadcrumb><a href=/developers itemprop=url><span itemprop=title>Developers</span></a></li><li itemscope itemtype=http://data-vocabulary.org/Breadcrumb><a href=/developers/framework itemprop=url><span itemprop=title>Framework</span></a></li><li class=active itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span itemprop=title>Models and Forms</span></li></ol><div class=row><div class=col-sm-2><nav class="docs-nav js-docs-nav" role=navigation><ul class="nav nav-stacked"><li><a href=/addons>Addons</a><ul class="nav nav-stacked"><li><a href=/addons/badges>Badges</a><ul class="nav nav-stacked"><li><a href=/addons/badges/adding-and-editing-badges>Adding and Editing Badges</a></li><li><a href=/addons/badges/giving-and-requesting-badges>Giving and Requesting Badges</a></li></ul></li><li><a href=/addons/gigya>Gigya Sign In</a></li><li><a href=/addons/groups>Groups</a><ul class="nav nav-stacked"><li><a href=/addons/groups/managing-groups>Managing Groups</a></li></ul></li><li><a href=/addons/pockets>Introduction to Pockets</a></li><li><a href=/addons/ranks>Ranks</a><ul class="nav nav-stacked"><li><a href=/addons/ranks/adding-and-editing-ranks>Adding and Editing Ranks</a></li><li><a href=/addons/ranks/applying-ranks-over-sso>Applying Ranks over SSO</a></li><li><a href=/addons/ranks/using-ranks-as-incentives>Using Ranks as Incentives</a></li><li><a href=/addons/ranks/using-ranks-to-defeat-spam-or-abuse>Using Ranks to Defeat Spam or Abuse</a></li></ul></li><li><a href=/addons/reactions>Reactions</a><ul class="nav nav-stacked"><li><a href=/addons/reactions/curating-with-reactions>Curating with Reactions</a></li><li><a href=/addons/reactions/adding-and-editing-reactions>Adding and Editing Reactions</a></li></ul></li><li><a href=/addons/reporting>Reporting</a></li><li><a href=/addons/statistics>Vanilla Statistics</a></li><li><a href=/addons/warnings-and-notes>Warnings and Notes</a><ul class="nav nav-stacked"><li><a href=/addons/warnings-and-notes/adding-and-editing-user-notes>Adding and Editing User Notes</a></li><li><a href=/addons/warnings-and-notes/upgrading-from-warnings>Upgrading from Warnings</a></li><li><a href=/addons/warnings-and-notes/warning-a-user>Warning a User</a></li></ul></li></ul></li><li><a href=/api>API</a><ul class="nav nav-stacked"><li><a href=/api/smart-id>Smart ID</a></li><li><a href=/api/categories>Categories</a></li><li><a href=/api/comments>Comments</a></li><li><a href=/api/discussions>Discussions</a></li><li><a href=/api/forum-administration>Forum Administration</a></li></ul></li><li><a href=/cloud>Cloud Services</a><ul class="nav nav-stacked"><li><a href=/cloud/integration>Integration Services</a></li><li><a href=/cloud/migration>Migration Services</a></li><li><a href=/cloud/repo>Repository</a></li><li><a href=/cloud/ssl>Setting up SSL (https)</a></li><li><a href=/cloud/staging>Staging Site</a></li><li><a href=/cloud/support>Support</a></li><li><a href=/cloud/theming>Theming Services</a></li></ul></li><li class=active><a href=/developers>Developers</a><ul class="nav nav-stacked"><li><a href=/developers/changelog>Changelog</a></li><li><a href=/developers/troubleshooting>Troubleshooting</a></li><li><a href=/developers/installation>Installation</a></li><li><a href=/developers/locales>Locales</a></li><li><a href=/developers/tools>Developer Tools</a></li><li><a href=/developers/community>Developers Community</a></li><li><a href=/developers/contributing>Contributing</a><ul class="nav nav-stacked"><li><a href=/developers/contributing/coding-standard>Coding Standard</a></li><li><a href=/developers/contributing/standards>Coding Standards</a></li></ul></li><li class=active><a href=/developers/framework>Framework</a><ul class="nav nav-stacked"><li><a href=/developers/framework/ajax>Asynchronous Requests</a></li><li><a href=/developers/framework/views>Views</a></li><li><a href=/developers/framework/controllers>Controllers</a></li><li><a href=/developers/framework/database>Database Queries</a></li><li><a href=/developers/framework/dispatcher>Dispatcher</a></li><li><a href=/developers/framework/helpers>Helpers</a></li><li><a href=/developers/framework/assets>Assets</a></li><li><a href=/developers/framework/inform>Inform Notifications</a></li><li class=active><a href=/developers/framework/models>Models and Forms</a></li><li><a href=/developers/framework/modules>Modules</a></li><li><a href=/developers/framework/permissions>Permissions</a></li><li><a href=/developers/framework/i18n>Internationalization &amp; Localization</a></li></ul></li><li><a href=/developers/importing>Importing</a><ul class="nav nav-stacked"><li><a href=/developers/importing/build>Building new porters</a></li><li><a href=/developers/importing/porter>Vanilla Porter</a></li><li><a href=/developers/importing/support>Supported platforms</a></li></ul></li><li><a href=/developers/plugins>Plugins</a><ul class="nav nav-stacked"><li><a href=/developers/plugins/quickstart>Plugin Quickstart</a></li></ul></li><li><a href=/developers/configuration>Configuration</a><ul class="nav nav-stacked"><li><a href=/developers/configuration/using>Using The Config</a></li></ul></li></ul></li><li><a href=/features>Features</a><ul class="nav nav-stacked"><li><a href=/features/categories>Categories</a></li><li><a href=/features/embedding>Embedding</a></li><li><a href=/features/mobile>Mobile</a></li><li><a href=/features/moderation>Moderation</a></li><li><a href=/features/notifications>Notifications</a></li><li><a href=/features/sso>Single Sign-On</a></li><li><a href=/features/setup>Setting Up Your New Forum</a></li><li><a href=/features/wordpress>WordPress Integration</a><ul class="nav nav-stacked"><li><a href=/features/wordpress/using-comments>Using Comments</a></li><li><a href=/features/wordpress/wishlist>WishList Integration</a></li></ul></li></ul></li><li><a href=/theming>Theming</a><ul class="nav nav-stacked"><li><a href=/theming/css>Theming CSS</a></li><li><a href=/theming/hooks>Theming Hooks</a></li><li><a href=/theming/quickstart>Theming Quickstart</a></li><li><a href=/theming/views>Theming Views</a></li><li><a href=/theming/smarty>Smarty</a><ul class="nav nav-stacked"><li><a href=/theming/smarty/asset>{asset}</a></li><li><a href=/theming/smarty/text>{text}</a></li><li><a href=/theming/smarty/custom-menu>{custom_menu}</a></li><li><a href=/theming/smarty/event>{event}</a></li><li><a href=/theming/smarty/i18n>{t}</a></li><li><a href=/theming/smarty/link>{link}</a></li><li><a href=/theming/smarty/breadcrumbs>{breadcrumbs}</a></li><li><a href=/theming/smarty/mobile-logo>{mobile_logo}</a></li><li><a href=/theming/smarty/permission>{permission}</a></li><li><a href=/theming/smarty/pocket>{pocket}</a></li><li><a href=/theming/smarty/searchbox>{searchbox}</a></li><li><a href=/theming/smarty/logo>{logo}</a></li></ul></li></ul></li></ul><p><a class=text-muted href=#top><strong>Back to top</strong></a></p></nav></div><div class=col-sm-10><div class="edit-doc pull-right"><a class="btn btn-default btn-xs" href=https://github.com/vanilla/vanilladocs/edit/master/docs/developers/framework/models.html.md>Improve document</a></div><article class=markdown-body role=article><h2 id=models>Models</h2><p>The theory of a Model in MVC is that it is an object representation of the data being manipulated. In Garden, however, the actual object representation of the data comes from the DataSet class in the form of a php stdClass. So, as you may have guessed already, in Garden the model isn’t a representation of the data. In Garden, a model relates directly to a table, and (with the help of the database object) allows you to retrieve information from the table, enforce the schema of that table on the data being manipulated, and put data into the table. The real power of the Model class in Garden comes from it’s ability to examine the table from which it was created, and understand the data types and requirements for putting data into that table. When combined with Garden’s Validation and Form classes, it allows you to create forms with validation already built in. The Model class itself is quite simple, and can be used on any table in the database. Let’s take a look at a very basic example of how a model could be used to get some data from a database, validate data, and update data.</p><pre class=highlight><code class="hljs php"><span class=hljs-comment>// Create a validation object to handle validation issues that the model will encounter:</span>
<span class=hljs-variable>$Validation</span> = <span class=hljs-keyword>new</span> Validation();

<span class=hljs-comment>// Create a new model based on a table in the database called "Blog":</span>
<span class=hljs-variable>$BlogModel</span> = <span class=hljs-keyword>new</span> Model(<span class=hljs-string>'Blog'</span>, <span class=hljs-variable>$Validation</span>);

<span class=hljs-comment>// Retrieve a DataSet from the Blog table:</span>
<span class=hljs-variable>$BlogData</span> = <span class=hljs-variable>$BlogModel</span>-&gt;GetWhere(<span class=hljs-keyword>array</span>(<span class=hljs-string>'BlogID'</span> =&gt; <span class=hljs-string>'12'</span>));

<span class=hljs-comment>// Grab the first row of the dataset as an associative array:</span>
<span class=hljs-variable>$Blog</span> = <span class=hljs-variable>$BlogData</span>-&gt;FirstRow(<span class=hljs-string>''</span>, DATASET_TYPE_ARRAY);

<span class=hljs-comment>// $Blog now contains every column of the "Blog" table where BlogID == 12. Let's change something:</span>
<span class=hljs-variable>$Blog</span>[<span class=hljs-string>'Title'</span>] = <span class=hljs-string>'Some blog title'</span>;

<span class=hljs-comment>// And save it:</span>
<span class=hljs-variable>$BlogModel</span>-&gt;Save(<span class=hljs-variable>$Blog</span>); <span class=hljs-comment>// Validates</span>

<span class=hljs-comment>// And let's try to insert something that we know shouldn't go into the database:</span>
<span class=hljs-variable>$Blog</span>[<span class=hljs-string>'BlogID'</span>] = <span class=hljs-string>'Not an Integer!'</span>;

<span class=hljs-comment>// And save it:</span>
<span class=hljs-variable>$BlogModel</span>-&gt;Save(<span class=hljs-variable>$Blog</span>); <span class=hljs-comment>// Doesn't validate</span>
</code></pre><p>When the model’s “GetWhere” method is called, it does a very simple <code>select * from Blog where BlogID = 12</code>query that returns all of the columns from that table into a dataset. At this point, the model still doesn’t know anything about the structure of the table. When the model’s “Save” method is called, the first thing it does is uses the Database object to get information about the table so that it can define the table’s schema. It looks at each column’s data types, isnullable, default values, keys, etc. Then it uses the validation object to build up a set of rules for each column. Finally, it examines the \$Blog that was passed as it’s first argument, matching up associative array keys with column names, and then checks each field against the rules automatically defined for that table. As it encounters problems, it builds up a set of validation results that can then be used however you wish (typically they are consumed by Garden’s form object and displayed on the screen). So, with just a few lines of code, I’ve grabbed data from the database, altered it, and saved it - making sure that no invalid data is inserted into the database, all exceptions are caught, and results can be delivered to the user:</p><pre class=highlight><code class="hljs php">print_r(<span class=hljs-variable>$BlogModel</span>-&gt;Validation-&gt;Results());
<span class=hljs-comment>// Prints:</span>
<span class=hljs-keyword>Array</span> (
    [BlogID] =&gt; <span class=hljs-keyword>Array</span> (
            [<span class=hljs-number>0</span>] =&gt; ValidateInteger
        )
)
</code></pre><p>This means that the &quot;BlogID&quot; field has encountered a problem when attempting to validate that the BlogID value was an integer. If there had been other errors for that column, they would have also appeared, for example:</p><pre class=highlight><code class="hljs php"><span class=hljs-comment>// Empty value is also incorrect</span>
<span class=hljs-variable>$Blog</span>[<span class=hljs-string>'BlogID'</span>] = <span class=hljs-string>''</span>;
<span class=hljs-variable>$BlogModel</span>-&gt;Save(<span class=hljs-variable>$Blog</span>);
print_r(<span class=hljs-variable>$BlogModel</span>-&gt;Validation-&gt;Results());

<span class=hljs-comment>// Prints:</span>
<span class=hljs-keyword>Array</span> (
    [BlogID] =&gt; <span class=hljs-keyword>Array</span> (
            [<span class=hljs-number>0</span>] =&gt; ValidateRequired,
            [<span class=hljs-number>1</span>] =&gt; ValidateInteger
        )
)
</code></pre><p>The validation object will always collect as much information about what is wrong with the data as possible. It is then up to the developer what to do with that information. Luckily, 99% of the time the developer will just let the Form handle the validation results.</p><h2 id=forms-validation>Forms &amp; Validation</h2><p>In order for the database, models, validation, &amp; datasets to shine, we need to get the information out and editable by the users. This is where the Form class comes into play. Let’s take a look at an actual example of how the controller, model, validator, and form work together. Let’s say we get the following request: <code>/bloggingtool/post/new</code> Which is the same as calling the following controller in an imaginary “bloggingtool” application: <code>$Post-&gt;New();</code>My “New” method on the post controller would contain:</p><pre class=highlight><code class="hljs php"><span class=hljs-keyword>public</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>New</span><span class=hljs-params>()</span> {</span>
   <span class=hljs-variable>$Validation</span> = <span class=hljs-keyword>new</span> Validation();
   <span class=hljs-variable>$BlogModel</span> = <span class=hljs-keyword>new</span> Model(<span class=hljs-string>'Blog'</span>, <span class=hljs-variable>$Validation</span>);

   <span class=hljs-comment>// Set the BlogModel on the form.</span>
   <span class=hljs-variable>$this</span>-&gt;Form-&gt;SetModel(<span class=hljs-variable>$BlogModel</span>);

   <span class=hljs-comment>// If the form has already been posted back...</span>
   <span class=hljs-keyword>if</span> (<span class=hljs-variable>$this</span>-&gt;Form-&gt;AuthenticatedPostBack()) {
      <span class=hljs-comment>// Attempt to save the form values</span>
      <span class=hljs-variable>$BlogID</span> = <span class=hljs-variable>$this</span>-&gt;Form-&gt;Save();

      <span class=hljs-comment>// If it saved, redirect to the new entry:</span>
      <span class=hljs-keyword>if</span> (<span class=hljs-variable>$BlogID</span> !== <span class=hljs-keyword>FALSE</span>)
         Redirect(<span class=hljs-string>'/bloggingtool/entries/'</span>.<span class=hljs-variable>$BlogID</span>);

   }
   <span class=hljs-comment>// Render the form</span>
   <span class=hljs-variable>$this</span>-&gt;Render();
}
</code></pre><p>The form’s <code>Save()</code> method calls the model’s <code>Save()</code> and then takes any validation results that came out of it. If the save was successful, the model would have returned the id of the record inserted (or updated). If not, it could take all of the validation results and write them to the screen for the user to see. That’s really all there is to saving a bunch of data to the database. You might be wondering: <strong>What fields were actually saved?</strong>That all depends on what you put on the form. The Form class is a “user interface” class, which means that a large number of it’s methods actually return xhtml. The view for my “New” method above would look something like this:</p><pre class=highlight><code class="hljs php"><span class=hljs-keyword>echo</span> <span class=hljs-variable>$this</span>-&gt;Form-&gt;Open();
<span class=hljs-keyword>echo</span> <span class=hljs-variable>$this</span>-&gt;Form-&gt;Errors();
<span class=hljs-keyword>echo</span> <span class=hljs-variable>$this</span>-&gt;Form-&gt;TextInput(<span class=hljs-string>'Title'</span>);
<span class=hljs-keyword>echo</span> <span class=hljs-variable>$this</span>-&gt;Form-&gt;TextBox(<span class=hljs-string>'Body'</span>);
<span class=hljs-keyword>echo</span> <span class=hljs-variable>$this</span>-&gt;Form-&gt;Close(<span class=hljs-string>'Save'</span>);
</code></pre><p>In this example, you can see I’ve referenced two fields on the Model that is being manipulated: <em>Title</em> and <em>Body</em>. When the form’s “Save” method is called above (and the Model’s “Save” method is called therein), the model validates and attempts to save the data. If one of these two fields were required, it would return a validation result that would then be written to the screen by <code>$this-&gt;Form-&gt;Errors()</code>. Furthermore, if there were a field on the “Blog” table that were required and not present on this form, it would have a validation result for that as well. What if we were editing a blog post instead of creating a new one?</p><pre class=highlight><code class="hljs php"><span class=hljs-keyword>public</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>Edit</span><span class=hljs-params>(<span class=hljs-variable>$BlogID</span> = <span class=hljs-string>''</span>)</span> {</span>
   <span class=hljs-variable>$Validation</span> = <span class=hljs-keyword>new</span> Validation();
   <span class=hljs-variable>$BlogModel</span> = <span class=hljs-keyword>new</span> Model(<span class=hljs-string>'Blog'</span>, <span class=hljs-variable>$Validation</span>);

   &lt;strong&gt;<span class=hljs-comment>// Load the blog being edited $Blog = $BlogModel -&gt;GetWhere(array('BlogID' =&gt; $BlogID)) -&gt;FirstRow();&lt;/strong&gt;</span>

   <span class=hljs-comment>// Set the BlogModel on the form.</span>
   <span class=hljs-variable>$this</span>-&gt;Form-&gt;SetModel(<span class=hljs-variable>$BlogModel</span>);

   <span class=hljs-comment>// Make sure the form knows which item we are editing.</span>
   <span class=hljs-variable>$this</span>-&gt;Form-&gt;AddHidden(<span class=hljs-string>'BlogID'</span>, <span class=hljs-variable>$BlogID</span>);

   <span class=hljs-comment>// If the form has NOT been posted back...</span>
   <span class=hljs-keyword>if</span> (<span class=hljs-variable>$this</span>-&gt;Form-&gt;AuthenticatedPostBack() === <span class=hljs-keyword>FALSE</span>) {
      <span class=hljs-comment>// Set the blog on the form</span>
      <span class=hljs-variable>$this</span>-&gt;Form-&gt;SetData(<span class=hljs-variable>$Blog</span>);
   } <span class=hljs-keyword>else</span> {
      <span class=hljs-comment>// Attempt to save the form values</span>
      <span class=hljs-variable>$BlogID</span> = <span class=hljs-variable>$this</span>-&gt;Form-&gt;Save();

      <span class=hljs-comment>// If it saved, redirect to the new entry:</span>
      <span class=hljs-keyword>if</span> (<span class=hljs-variable>$BlogID</span> !== <span class=hljs-keyword>FALSE</span>)
         Redirect(<span class=hljs-string>'/bloggingtool/entries/'</span>.<span class=hljs-variable>$BlogID</span>);

   }
   <span class=hljs-comment>// Render the form</span>
   <span class=hljs-variable>$this</span>-&gt;Render();
}
</code></pre><p>I load the blog and set it’s data onto the form using <code>$this-&gt;Form-&gt;SetData()</code>. At that point the form takes over and knows to either (a) render the existing data if the form has not been posted back, or (b) render the postback data otherwise. And since I added the BlogID to the form’s hidden field collection, the model will know that it should update a blog row instead of insert a new one.</p></article></div></div></div><footer class="footer js-footer"><div class=jumbotron><div class=container><div class=row><div class=col-sm-6><h3><a href=#>Cloud Hosting</a></h3><p><strong>We believe that online communities should be intuitive, engaging and true to your brand.</strong> Vanilla allows you to create a customized community that rewards positive participation, automatically curates content and lets members drive moderation.</p></div><div class=col-sm-6><h3><a href=#>Open Source</a></h3><p>Vanilla provides cloud and open source community forum software that powers discussion forums on more than 700,000 sites. Built for flexibility and integration, <strong>Vanilla is the best, most powerful community solution in the world.</strong></p></div></div></div></div><div class=footer-copyright><div class=container><p class=text-center>Copyright &copy; 2009-2014 <a href=//vanillaforums.com>Vanilla Forums Inc.</a> All rights reserved.</p><ul class="list-inline text-center"><li><a href=//docs.vanillaforums.com>Docs</a></li><li><a href=//blog.vanillaforums.com>Blog</a></li><li><a href=//vanillaforums.com>Cloud</a></li><li><a href=//vanillaforums.org>Community</a></li><li><a href=https://github.com/vanilla>GitHub</a></li><li><a href=https://github.com/vanilla/vanilla/issues>Issues</a></li></ul></div></div></footer><script src=/assets/115fed0b.main.js></script>